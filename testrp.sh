// TODO: refactor this callback mess
